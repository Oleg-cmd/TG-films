"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[171],{3301:function(e,t,s){s.d(t,{b:function(){return h}});var i=s(7437),n=s(2265),o=s(4949),a=s(6061),r=s(7042),c=s(3986);window.innerWidth;let l=(0,a.j)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:s,variant:n,size:a,asChild:d=!1,...h}=e,g=d?o.g7:"button";return(0,i.jsx)(g,{className:function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,c.m)((0,r.W)(t))}(l({variant:n,size:a,className:s})),ref:t,...h})});d.displayName="Button";var h=()=>(0,i.jsx)("div",{className:"absolute inset-0 opacity-[0.05] pointer-events-none",style:{backgroundImage:"url('/images/svg/topography.svg')",backgroundSize:"400px"}})},6440:function(e,t,s){s.d(t,{c:function(){return c}});var i=s(4256),n=s(4829),o=s(4886);class a{static getInstance(){return a.instance||(a.instance=new a),a.instance}setOnConnectCallback(e){this.onConnectCallback=e}connect(){if(this.isConnected){console.log("Already connected to WebSocket.");return}this.socket=new WebSocket("wss://movies-ls-titanium-velocity.trycloudflare.com/ws"),this.socket.onopen=()=>{console.log("WebSocket connection opened")},this.socket.onclose=()=>{console.log("WebSocket connection closed")},this.stompClient=new o.K({webSocketFactory:()=>this.socket,onConnect:()=>{this.isConnected=!0,console.log("STOMP connection established"),this.onConnectCallback&&this.onConnectCallback()},onStompError:e=>{console.error("STOMP Error: "+e.headers.message),console.error("STOMP Error details: "+e.body)}}),this.stompClient.activate()}disconnect(){this.stompClient&&this.stompClient.connected&&(this.stompClient.deactivate(),this.isConnected=!1,console.log("STOMP connection closed"))}subscribe(e,t){this.stompClient&&this.stompClient.connected?(console.log("Subscribing to ".concat(e)),this.stompClient.subscribe(e,t)):console.error("WebSocket is not connected.")}send(e,t){this.stompClient&&this.stompClient.connected?(this.stompClient.publish({destination:e,body:t}),console.log("Sent message:",t)):console.error("WebSocket is not connected.")}constructor(){this.stompClient=null,this.socket=null,this.isConnected=!1,this.onConnectCallback=null}}a.instance=null;var r=s(225);let c=new class{getOrCreateTelegramId(){let e=localStorage.getItem("telegramId");return e||(e=(0,r.Z)(),localStorage.setItem("telegramId",e)),e}setInviteCode(e){this.inviteCode=e}setSettings(e){this.isUpdatingSettings=!0,console.log("setSettings called with:",e),this.selectedGenres=null==e?void 0:e.selectedGenres,this.startYear=null==e?void 0:e.startYear,this.endYear=null==e?void 0:e.endYear,this.rating=null==e?void 0:e.rating,this.isUpdatingSettings=!1}updateSettings(e){this.isInitialSettingsSet&&(this.isUpdatingSettings=!0,this.selectedGenres=null==e?void 0:e.selectedGenres,this.startYear=null==e?void 0:e.startYear,this.endYear=null==e?void 0:e.endYear,this.rating=null==e?void 0:e.rating,this.isUpdatingSettings=!1)}getDestination(e,t){return"connect"===t?"/app/connect":"join"===t?"/app/rooms/".concat(e,"/join"):"settings"===t?"/app/rooms/".concat(e,"/settings"):"ready"===t?"/app/rooms/".concat(e,"/ready"):"swipe"===t?"/app/rooms/".concat(e,"/swipe"):""}toggleGenre(e){!this.isUpdatingSettings&&this.isInitialSettingsSet&&(this.isLocalChange=!0,this.selectedGenres=this.selectedGenres.includes(e)?this.selectedGenres.filter(t=>t!==e):[...this.selectedGenres,e],this.sendSettings(),this.isReady=!1,this.isLocalChange=!1)}setStartYear(e){!this.isUpdatingSettings&&this.isInitialSettingsSet&&(this.isLocalChange=!0,this.startYear=e,this.sendSettings(),this.isReady=!1,this.isLocalChange=!1)}setEndYear(e){!this.isUpdatingSettings&&this.isInitialSettingsSet&&(this.isLocalChange=!0,this.endYear=e,this.sendSettings(),this.isReady=!1,this.isLocalChange=!1)}setRating(e){!this.isUpdatingSettings&&this.isInitialSettingsSet&&(this.isLocalChange=!0,this.rating=e,this.sendSettings(),this.isReady=!1,this.isLocalChange=!1)}setIsReady(e){this.isReady=e}setReadyCount(e){this.readyCount=e}setParticipantsCount(e){this.participantsCount=e}setAvaliableGenres(e){this.availableGenres=e}updateCards(e){this.cards=e,console.log(e)}setCards(e){this.cards=e}constructor(){this.selectedGenres=[],this.startYear=null,this.endYear=null,this.rating=null,this.isReady=!1,this.readyCount=void 0,this.participantsCount=void 0,this.inviteCode="J6a89W6J",this.telegramId="",this.availableGenres=[],this.cards=[],this.isUpdatingSettings=!1,this.isInitialSettingsSet=!1,this.isLocalChange=!1,this.matchStatus="none",this.matchedMovie=null,this.setMatchedMovie=e=>{this.matchedMovie=e},this.setMatchStatus=e=>{this.matchStatus=e},this.setInitialSettings=e=>{e&&(this.selectedGenres=e.selectedGenres,this.startYear=e.startYear,this.endYear=e.endYear,this.rating=e.rating,this.isInitialSettingsSet=!0)},this.connect=()=>{console.log("Connecting...");let e=new URLSearchParams(window.location.search),t=null==e?void 0:e.get("inviteCode");null==e||e.get("telegramId"),t&&(this.inviteCode=t,console.log("inviteCode from url:",t)),this.webSocketService.connect()},this.onConnected=()=>{console.log("Connected to WebSocket"),this.webSocketService.subscribe("/topic/connect",e=>{console.log("Received connect message:",e);try{let t=JSON.parse(e.body);t.inviteCode&&(console.log("connect message:",t),this.setInviteCode(t.inviteCode))}catch(e){console.error("Error parsing connect message:",e)}}),this.webSocketService.subscribe("/topic/rooms/".concat(this.inviteCode,"/settings"),e=>{console.log("Settings message received before try:",e);try{let t=JSON.parse(e.body);console.log("Settings message received:",t),this.startYear?this.updateSettings(t):this.setInitialSettings(t)}catch(e){console.error("Error parsing settings message:",e)}}),this.webSocketService.subscribe("/topic/rooms/".concat(this.inviteCode,"/ready"),e=>{console.log("Ready message received:",e);try{let t=JSON.parse(e.body);this.setReadyCount(t.readyCount),this.setParticipantsCount(t.participantsCount),console.log("ready message parsed:",t)}catch(e){console.error("Error parsing ready message:",e)}}),this.webSocketService.subscribe("/topic/rooms/".concat(this.inviteCode,"/match"),e=>{console.log("Match message received:",e);try{let t=JSON.parse(e.body);this.setMatchStatus("match"),this.setMatchedMovie(t),console.log("match message parsed:",t)}catch(e){console.error("Error parsing match message:",e)}}),this.webSocketService.subscribe("/topic/rooms/".concat(this.inviteCode,"/wait"),e=>{console.log("wait message received:",e);try{let t=JSON.parse(e.body);this.setMatchStatus("wait"),this.setMatchedMovie(t),console.log("wait message parsed:",t)}catch(e){console.error("Error parsing wait message:",e)}}),this.webSocketService.subscribe("/topic/rooms/".concat(this.inviteCode,"/events"),e=>{console.log("Event message received:",e);try{let t=JSON.parse(e.body);if("object"==typeof t&&null!==t&&t.message&&t.message.includes("Game started")){if(console.log("Game started message parsed:",t),t.movies&&Array.isArray(t.movies)){let e=t.movies.map(e=>{let t="object"==typeof e.genre&&null!==e.genre?e.genre.name:e.genre;return{id:e.movieId,title:e.title,year:e.releaseYear,genre:t,rating:e.externalRating,poster:e.posterUrl,description:e.description}});this.updateCards(e)}else console.error("No movies found in message:",t)}}catch(t){console.error("Error processing event message:",t,e.body)}}),this.inviteCode&&"server_side_user"!==this.telegramId&&this.sendMessage({type:"join",telegramId:this.telegramId,inviteCode:this.inviteCode}),this.getGenres()},this.onError=e=>{console.error("Error connecting to WebSocket:",e)},this.sendMessage=e=>{let t;let s=this.getDestination(e.inviteCode,e.type);if("connect"===e.type)t=e.telegramId,this.webSocketService.send(s,t);else if("join"===e.type){if("server_side_user"===this.telegramId)return;t=e.telegramId,this.webSocketService.send(s,t)}else if("settings"===e.type)t=JSON.stringify({selectedGenres:this.selectedGenres,startYear:this.startYear,endYear:this.endYear,rating:this.rating}),this.webSocketService.send(s,t);else if("ready"===e.type){if("server_side_user"===this.telegramId)return;t=JSON.stringify({telegramId:e.telegramId,isReady:this.isReady}),this.webSocketService.send(s,t)}else"swipe"===e.type&&(t=JSON.stringify(e.payload),this.webSocketService.send(s,t));console.log("Sent: "+JSON.stringify(e))},this.popCard=()=>{this.cards.pop()},this.sendSettings=()=>{this.sendMessage({type:"settings",inviteCode:this.inviteCode})},this.getGenres=async()=>{try{let e=await n.Z.get("".concat("https://movies-ls-titanium-velocity.trycloudflare.com","/api/genres"));this.setAvaliableGenres(e.data.map(e=>e.name)),console.log("got genres")}catch(e){console.log("Error fetching genres:",e)}},this.telegramId=this.getOrCreateTelegramId(),(0,i.ky)(this,{setInviteCode:i.aD.bound,setSettings:i.aD.bound,updateSettings:i.aD.bound,toggleGenre:i.aD.bound,setStartYear:i.aD.bound,setEndYear:i.aD.bound,setRating:i.aD.bound,setIsReady:i.aD.bound,setReadyCount:i.aD.bound,setParticipantsCount:i.aD.bound,setAvaliableGenres:i.aD.bound,setCards:i.aD.bound,updateCards:i.aD.bound,setInitialSettings:i.aD.bound,popCard:i.aD.bound,setMatchStatus:i.aD.bound,setMatchedMovie:i.aD.bound}),this.webSocketService=a.getInstance(),this.webSocketService.setOnConnectCallback(this.onConnected),this.connect()}}}}]);